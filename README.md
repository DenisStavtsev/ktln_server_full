# ktln_server_full

Описание

Разработать <b>приложение - сервер</b>, которое слушает указанный в конфигурации порт
и выполняет команды, полученные по сети.

Команды - различные операции над двумя целочисленными параметрами.

Требуется реализовать три математические операции: <b>сложение, умножение,
возведение в степень.</b>

Также требуется реализовать операцию <b>ввода битности результата выполнения</b>.
По запросу этой операции пользователю предлагается выбрать опцию из
выпадающего списка со значениями [8,16, 24, 32, 40, 48, 56, 64], представляющую
собой битность значения, которое будет отправлено как результат операции.

Конфигурация приложения должна производиться через <b>xml файл загружаемый с
указанного HTTP сервера.</b>

Порядок работы следующий:
После запуска приложения, <b>в GUI пользователь вводит адрес и порт http-сервера
с конфигурацией</b>, и нажимает кнопку Инициализировать.
Приложение загружает файл config.xml, разбирает его и запускает основной цикл
работы: ожидание команды, выполнение действия <b>в отдельном потоке</b>, отправка
ответа.
Основной цикл приложения требуется оформить как android-сервис с автозапуском.
Если инициализация не была выполнена - сервис остается выключен. Если
инициализация была произведена - сервис устанавливается на автозапуск.

<b>Протокол сообщений</b>

Протокол сообщений - бинарный, в следующем формате:

<b>Запрос:</b>
LL CC PP VV
LL - длина сообщения, два байта, big-endian
CC - код команды, два байта, big-endian
PP - первый параметр, N байт, big-endian, целое число
VV - второй параметр, N байт, big-endian, целое число

Размер в байтах параметров одинаковый.
Ограничения на N >= 0 && N <= 8;

Пример (HEX-представление)
0008 00A1 000001 000002 - сообщение длиной 8 байт с командой 00A1 и двумя 24ех
битными операндами (не зависит от битности выставленной результату).
00 02 00D1 - сообщение длиной 2 байта с командой 00D1 без операндов.

<b>Ответ:</b>
LL CC RR ..
LL - длина сообщения, два байта, big-endian
СС - код команды, два байта, big-endian
RR .. - результат операции, M байт, big-endian, целое число.

Ограничения на M > 0 && M <= 8;

Соответствие кода команды и выполняемой операции прописывается в конфигурации.
Пример (HEX-представление)
00 06 00A1 00000003 - 6 байт, команда 00A1, одно 32х битное число ответа.
00 06 00D1 00000040- 6 байт, команда 00D1, одно 32х битное число ответа (по
умолчанию битность ответа стоит 32, смотри ниже)

<b>Файл конфигурации</b>

Конфигурация приложения задается через xml-файл, скачиваемый по HTTP с
указанного сервера.
Имя файла конфигурации принять за <b>config.xml</b>, расположение - <b>в корне HTTP
сервера</b>

<b>Формат:</b>

<config port=”2222” res_bits=”32”>
<cmd value=”00A1” method=”sum”/>
<cmd value=”00B1” method=”mul”/>
<cmd value=”00С1” method=”pow”/>
<cmd value=”00D1” method=”set_bits”/>
</config>

<b>res_bits</b> - количество бит в ответе по умолчанию.
<b>value</b> - код команды в HEX виде, соответствующий указанному методу;
<b>method</b> имя метода, который должно выполнить приложение.

<b>Метод приложение должно получать через механизм рефлексии из
соответствующего класса в приложении.</b>

Не допускается использовать таблицы или условия вида if (method.equals(“sum”))
doSum(p1,p2).

В результате выполнения операции пользовательского ввода битности результата
должен быть показан диалог ввода, по результатам работы которого все последующие
операции используют битность ответа заданную в нем.
Т.е. если в начальной конфигурации res_bits = 32, то на запрос
00 02 00D1 придет ответ 00 06 00D1 00000008 - где 00000008 - число 8 (32 бита, 4
байта) введенное пользователем.
На следующую комманду (например 00 04 00A1 0001 0002 ) будет возвращен ответ
уже с 8 битами результата (то есть 00 03 00A1 03 )

Если приложение находится в состоянии ожидания ввода от пользователя, на все
запросы действий оно тут же должно ответить значением “DEAD” в байтах результата
независимо от нужной битности результата.

Все настройки (инициализационные и введенные пользователем, такие как система
счисления) должны сохранятся на устройстве и не сбрасываться после перезагрузки
ОС.
